<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Shape Editor - Alpha</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />

        <!-- mvp css -->
        <link rel="stylesheet" href="https://unpkg.com/mvp.css"> <!-- temporal css sheet -->
        <link rel="stylesheet" href="css/editor-style.css" />

        <!-- OpenLayers style lib -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css" type="text/css">
        <link rel="stylesheet" href="css/ol_popup.css" type="text/css">

    </head>
    <body style="padding: 0;"> <!-------- FIXME -------->

        <div id="loading_screen"  class="loading_screen">
            <img alt="loading_gif" src="https://mir-s3-cdn-cf.behance.net/project_modules/disp/ab79a231234507.564a1d23814ef.gif"/>
        </div>

        <div class="sidetools">
            <button onclick="downloadString(o_se_group.historyString(), 'street_element_group_history.js')">Save</button> <!-- TODO change expr -->
            <button onclick="toggleHideMap()">Map</button>

            <label>Type </label>
            <input type="radio" id="nt_shape" name="node_type" value="shape" checked="true">
            <label for="nt_shape">Shape</label><br>
            <input type="radio" id="nt_endpoint" name="node_type" value="endpoint" checked="false">
            <label for="nt_endpoint">Endpoint</label><br>
            <input type="radio" id="nt_stop" name="node_type" value="stop" checked="false">
            <label for="nt_stop">Stop</label><br>
            <input type="radio" id="nt_fork" name="node_type" value="fork" checked="false">
            <label for="nt_fork">Intersection</label><br>

            <label>Action </label>
            <select onchange="onActionChange()" id="action">
                <option value="select">select</option>
                <option value="add">add</option>
                <option value="split">split</option> <!-- RENAME TODO -->
                <option value="move">move</option>
                <option value="remove">remove</option> <!-- RENAME TODO -->
                <option value="cut">cut</option> <!-- RENAME TODO -->
            </select>

            <label>View</label>

            <input type="checkbox" id="view_nodes_cb" value="Nodes" checked="true">
            <label for="view_nodes_cb">Show Nodes</label><br>
            <input type="checkbox" id="view_links_cb" value="Links" checked="true">
            <label for="view_links_cb">Show Links</label><br>
            <input type="checkbox" id="view_stops_cb" value="Stops" checked="true">
            <label for="view_stops_cb">Show Stops</label>

        </div>
        <div class="body-container">

            <!-- Openstreet map -->
            <div id="map_container" class="map_container"></div>

            <!-- ----------------- key command board ------------------------ -->

            <!-- TODO -->
            <div id="editor_gtfs_tables" class="table-wrapper">

                <!-- <popup :content="popup_info"></popup> <!-- TODO -->

                <div id="popup_node_info" class="ol-popup">
                    <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                    <div id="popup-content">
                        Node ID: {{ popup_content.id }}<br>
                        <label for="ol_node_type">Node type: </label>
                        <select id="ol_node_type" name="ol_node_type" v-model="popup_content.type">
                            <option value="fork">
                                Intersection
                            </option>
                            <option v-if="popup_content.connections < 3" value="shape">
                                Shape
                            </option>
                            <option v-if="popup_content.connections < 3" value="stop">
                                Stop
                            </option>
                            <option v-if="popup_content.connections < 3" value="endpoint">
                                Endpoint
                            </option>
                        </select>

                        <div v-show="popup_node_type_is_stop">
                            <label for="ol_in_stop_id">Stop ID: </label>
                            <input type="text" id="ol_in_stop_id" name="ol_in_stop_id" placeholder="Stop ID" :value="popup_content.stop_info.id"/>
                            <label for="ol_in_stop_name">Stop name: </label>
                            <input type="text" id="ol_in_stop_name" name="ol_in_stop_name" placeholder="Stop Name" :value="popup_content.stop_info.name"/>
                        </div>

                        <button @click="changeNodeInfoFromPopup(popup_content.id)">save</button>

                    </div>
                </div>

                <!-- <table style="background: black; width: 100%; display: table;"> -->
                <table style="width: 100%; display: table;"> <!-- TODO: change buttons format and replace table by a proper class -->
                    <tr>
                        <th><button @click="showAgency">agency</button></th>
                        <th><button @click="showShape">shapes</button></th>
                        <th><button @click="showStop">stops</button></th>
                        <th><button @click="showRoute">routes</button></th>
                        <th><button @click="showCalendar">calendar</button></th>
                        <th><button @click="showTrip">trips</button></th>
                        <th><button @click="showStopTime">stop_times</button></th>
                    </tr>
                </table>

                <!-- SHAPES -->
                <div v-show="isVisible('shape')">
                    Add a new shape:<br>
                    <table class="alt"><tr>
                        <th><input id="new_shape_id" name="new_shape_id" type="text" :value="'shp_' + shapes.length" placeholder="Shape ID" /></th>

                        <!-- segments in new_shape -->
                        <!-- <th v-for="segment in ns_segments"> -->
                        <th>
                            {{new_shape_sequence}}
                        </th>
                        <!-- end segments -->

                        <!-- new segment (a node and a link for direction)-->
                        <th v-show="!ns_segments.length">
                            <select @change="newShapeOnChange($event, 'node')">
                            <option value="noselect"> - </option>
                            <option v-for="node in new_shape_allowed_nodes" :value="node.getID">E{{node.getID}}</option>
                            </select>
                        </th>

                        <!-- allowed links -->
                        <th v-show="ns_allowed_links.length">
                            <select id="ns_shape_link_select" @change="newShapeOnChange($event, 'link')">
                               <option value="noselect"> - </option>
                               <option v-for="link in ns_allowed_links" :value="link.getID">L{{link.getID}}</option>
                            </select>
                        </th>

                        <!-- element to add new segments in shape? -->
                        <th><button @click="saveShapeStop()" v-show="ns_segments.length">abort</button></th>
                        <th><button @click="saveShape()">add</button></th>
                    </tr></table>
                    <br>
                    <table class="alt">
                        <thead>
                            <tr>
                                <th v-for="field in shapeFields">{{field}}</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="shape in rev_shapes" :key="shape.getID()">
                                <td>{{shape.getID()}}</td>
                                <!-- <td>{{shape.getSequenceText()}}</td> // REMOVE method -->
                                <td>
                                    <!-- <div v-for="nodea,link,nodeb in shape.getSegments()">
                                         {{nodea}}{{link}}{{nodeb}}
                                         </div> -->
                                </td>
                                <td><button>save</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- END SHAPES -->

                <!-- AGENCY -->
                <table v-show="isVisible('agency')" class="alt" style="table-layout: fixed; width: 100%; word-wrap: break-word;">
                    <thead>
                        <tr>
                            <th v-for="field in agencyFields">{{field}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" id="agency_id" placeholder="ID" required></td> <!-- required TODO -->
                            <td><input type="text" id="agency_name" placeholder="Name" required></td>
                            <td><input type="text" id="agency_url" placeholder="URL" required></td>
                            <td><input type="text" id="agency_timezone" required></td>
                            <td><input type="text" id="agency_lang"></td>
                            <td><input type="text" id="agency_phone"></td>
                            <td><input type="text" id="agency_fare_url"></td>
                            <td><input type="text" id="agency_email"></td>
                            <td><button @click="saveAgency">add</button></td>
                        </tr>
                        <tr v-for="agency in rev_agencies">
                            <td v-for="field in agency" >{{field}}</td>
                            <td><button @click="removeAgency(agency.agency_id)">remove</button></td>
                        </tr>

                    </tbody>
                </table>
                <!-- END AGENCY -->

                <!-- STOPS -->
                <table v-show="isVisible('stop')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in stopFields">{{field}}</th>

                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="stop in rev_stops">
                            <td><input type="text" :id="'stop_id_'+stop.getID"   :value="stop.getStopInfo().id"></td>

                            <!-- Page 1 -->
                            <td><input type="text" :id="'stop_name_'+stop.getID" :value="stop.getStopInfo().name"></td>
                            <td><input type="text" :id="'stop_desc_'+stop.getID" :value="stop.getStopInfo().description"></td>

                            <!-- Page 2 -->
                            <td><input type="text" :id="'stop_url_'+stop.getID"></td>
                            <td><button @click="changeNodeInfoFromStopSection(stop.getID)">save</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END STOPS -->

                <!-- ROUTES -->
                <table v-show="isVisible('route')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in routeFields">{{field}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <!-- <th v-for="field in routeFields"><input type="text" :id="field"></th> -->
                            <td><input type="text" id="r_route_id"></td>
                            <td><select id="r_agency_id">
                                <option v-for="agency in rev_agencies" :value="agency.agency_id">{{agency.agency_id}}</option>
                            </select></td>
                            <td><input type="text" id="r_route_short_name"></td>
                            <td><input type="text" id="r_route_long_name"></td>
                            <td><select id="r_route_type">
                                <option v-for="routeType in r_routeType" :value="routeType.value">{{routeType.name}}</option>
                            </select></td>
                            <td><button @click="saveRoute">add</button></td>
                        </tr>
                        <tr v-for="route in rev_routes">
                            <td v-for="field in route" >{{field}}</td> <!-- FIXME: need review -->
                            <td><button @click="removeRoute(route.getID())">remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END ROUTES -->

                <!-- CALENDAR -->
                <table v-show="isVisible('calendar')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in calendarFields">{{field}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" id="c_service_id"></td>
                            <td v-for="field in calendarCheckboxFields">
                                <input type="checkbox" :id="field" checked="true">
                                <!-- <label for="view_nodes_cb">{{field}}</label><br> -->
                            </td>
                            <td><input type="text" id="c_start_day"></td>
                            <td><input type="text" id="c_end_day"></td>
                            <td><button @click="saveCalendar">add</button></td>
                        </tr>
                        <tr v-for="service in rev_services">
                            <td>{{ service.getID() }}</td>
                            <td v-for="status in service.getServiceDays()">
                                <div v-if="status" class="green_text">
                                    active
                                </div>
                                <div v-if="!status" class="red_text">
                                    inactive
                                </div>
                                <!-- status ? "active" : "inactive" -->
                            </td>
                            <td><button>remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END CALENDAR -->

                <!-- TRIPS -->
                <table v-show="isVisible('trip')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in tripFields">{{field}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <select id="t_route_id">
                                    <option v-for="route in rev_routes" :value="route.getID()">{{route.getID()}}</option>
                                </select>
                            </td>
                            <td>
                                <select id="t_service_id">
                                    <option v-for="service in rev_services" :value="service.getID()">{{service.getID()}}</option>
                                </select>
                            </td>
                            <td><input type="text" id="t_trip_id"></td>
                            <td><select id="t_direction_id">
                                <option value="0">outbound travel</option>
                                <option value="1">inbound travel</option>
                            </select></td>
                            <td><select id="t_shape_id">
                                <option v-for="shape in rev_shapes" :value="shape.name">{{shape.name}}</option>
                            </select></td>
                            <td><button @click="saveTrip">add</button></td>
                        </tr>
                        <tr v-for="trip in rev_trips">
                            <td v-for="field in trip" >{{field}}</td> <!-- FIXME: need review -->
                            <td><button @click="removeTrip(trip.trip_id)">{{ translate("remove") }}</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END TRIPS -->

                <!-- STOPTIMES -->
                <table v-show="isVisible('stoptime')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in stopTimeFields">{{field}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td v-for="field in stopTimeFields"><input type="text" :id="field"></td>
                            <td><button @click="saveStopTime">add</button></td>
                        </tr>
                        <tr v-for="stoptime in rev_stoptimes">
                            <td v-for="field in stoptime" >{{field}}</td> <!-- FIXME: need review -->
                            <td><button @click="removeStopTime(stoptime.trip_id, stoptime.stop_id)">remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END STOPTIMES -->

            </div>

            <!-- --------------  END key command board  --------------------- -->

            map: OpenStreetMap
        </div>

        <!-- <script src="https://unpkg.com/elm-pep"></script> -->
        <script src="https://unpkg.com/vue"></script>

        <!-- Vue 3 TODO -->
        <!-- <script src="https://unpkg.com/vue@3.0.0-beta.12/dist/vue.global.js"></script> -->

        <!-- OpenLayers library we use to show the map and draw on it -->
        <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>

        <!-- Axios to post data -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

        <!-- editor history / file loaded FIXME remove-->
        <script src="js/street_element_group_history.js"></script>

        <!-- Map GTFS elements -->
        <script src="js/streetElementNode.js"></script>        <!-- Node     class -->
        <script src="js/streetElementLink.js"></script>        <!-- Link     class -->
        <script src="js/streetElementAgency.js"></script>      <!-- Agency   class -->
        <script src="js/streetElementRoute.js"></script>       <!-- Route    class -->
        <script src="js/streetElementCalendar.js"></script>    <!-- Calendar class -->
        <script src="js/streetElementShape.js"></script>       <!-- Shape    class -->
        <script src="js/streetElementTrip.js"></script>        <!-- Trip     class -->
        <script src="js/streetElementStopTime.js"></script>    <!-- StopTime class -->
        <script src="js/streetElementGroup.js"></script>       <!-- Group    class -->

        <!-- variables and listeners -->
        <script src="js/map_main.js"></script>

    </body>
</html>
