<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />
        <title>Shape Editor - Alpha</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />

        <!-- Chota CSS -->
        <link rel="stylesheet" href="https://unpkg.com/chota@latest">
        <link rel="stylesheet" href="css/editor-style.css" />

        <!-- OpenLayers style lib -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css" type="text/css">
        <link rel="stylesheet" href="css/ol_popup.css" type="text/css">

    </head>
    <body style="padding: 0;"> <!-------- FIXME -------->

        <div id="loading_screen"  class="loading_screen">
            <img alt="loading_gif" src="https://mir-s3-cdn-cf.behance.net/project_modules/disp/ab79a231234507.564a1d23814ef.gif"/> <!-- FIXME -->
        </div>

        <div id="editor_gtfs"><div class="sidetools">
            <div class="button_grid">
                <button class="button primary icon" onclick="downloadString(o_se_group.historyString(), 'street_element_group_history.js')">
                    Save
                    <img src="https://icongr.am/feather/file.svg?size=16&amp;color=ffffff" alt="icon">
                </button>
                <button onclick="toggleHideMap()">Map</button>
            </div><br>

            <div class="toolbar">
                <label>Action </label><br>
                <select onchange="onActionChange()" id="action">
                    <option class="orange_text" value="select">select</option>
                    <option value="add">add</option>
                    <option value="split">split</option> <!-- RENAME TODO -->
                    <option value="move">move</option>
                    <option value="remove">remove</option> <!-- RENAME TODO -->
                    <option value="cut">cut</option> <!-- RENAME TODO -->
                </select>

                <label>Type </label><br>
                <input type="radio" id="nt_shape" name="node_type" value="shape" checked="true">
                <label for="nt_shape">Shape</label><br>
                <input type="radio" id="nt_endpoint" name="node_type" value="endpoint" checked="false">
                <label for="nt_endpoint">Endpoint</label><br>
                <input type="radio" id="nt_stop" name="node_type" value="stop" checked="false">
                <label for="nt_stop">Stop</label><br>
                <input type="radio" id="nt_fork" name="node_type" value="fork" checked="false">
                <label for="nt_fork">Intersection</label><br>

                <label>View</label><br>
                <input type="checkbox" id="view_nodes_cb" value="Nodes" checked="true">
                <label for="view_nodes_cb">Show Nodes</label><br>
                <input type="checkbox" id="view_links_cb" value="Links" checked="true">
                <label for="view_links_cb">Show Links</label><br>
                <input type="checkbox" id="view_stops_cb" value="Stops" checked="true">
                <label for="view_stops_cb">Show Stops</label>
            </div>
        </div>
        <div class="body-container">

            <!-- Openstreet map -->
            <div id="map_container" class="map_container"></div>

            <!-- ----------------- key command board ------------------------ -->

            <!-- TODO -->
            <div class="table-wrapper">

                <!-- <popup :content="popup_info"></popup> <!-- TODO -->

                <div id="popup_node_info" class="ol-popup">
                    <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                    <div id="popup-content">
                        Node ID: {{ popup_content.id }}<br>
                        <label for="ol_node_type">Node type: </label>
                        <select id="ol_node_type" name="ol_node_type" v-model="popup_content.type">
                            <option value="fork">
                                Intersection
                            </option>
                            <option v-if="popup_content.connections < 3" value="shape">
                                Shape
                            </option>
                            <option v-if="popup_content.connections < 3" value="stop">
                                Stop
                            </option>
                            <option v-if="popup_content.connections < 3" value="endpoint">
                                Endpoint
                            </option>
                        </select>

                        <div v-show="popup_node_type_is_stop">
                            <label for="ol_in_stop_id">Stop ID: </label>
                            <input type="text" id="ol_in_stop_id" name="ol_in_stop_id" placeholder="Stop ID" :value="popup_content.stop_info.id"/>
                            <label for="ol_in_stop_name">Stop name: </label>
                            <input type="text" id="ol_in_stop_name" name="ol_in_stop_name" placeholder="Stop Name" :value="popup_content.stop_info.name"/>
                        </div>

                        <button @click="changeNodeInfoFromPopup(popup_content.id)">save</button>

                    </div>
                </div>

                <div class="horizontaltoolbar">
                    <div class="col"><button class="button primary" @click="showList = 'agency'"  >{{ dict.agency     }}</button></div>
                    <div class="col"><button class="button primary" @click="showList = 'shape'"   >{{ dict.shapes     }}</button></div>
                    <div class="col"><button class="button primary" @click="showList = 'stop'"    >{{ dict.stops      }}</button></div>
                    <div class="col"><button class="button primary" @click="showList = 'route'"   >{{ dict.routes     }}</button></div>
                    <div class="col"><button class="button primary" @click="showList = 'trip'"    >{{ dict.trips      }}</button></div>
                    <div class="col"><button class="button primary" @click="showList = 'stoptime'">{{ dict.stop_times }}</button></div>
                    <div class="col"><button class="button primary" @click="showList = 'calendar'">{{ dict.calendar   }}</button></div>
                    <div class="col"><button class="button primary" @click="showList = 'scheme'"  >{{ dict.scheme     }}</button></div>
                </div>

                <!-- SHAPES -->
                <div v-show="isVisible('shape')">
                    Add a new shape:<br>
                    <table class="alt"><tr>
                        <th><input id="new_shape_id" name="new_shape_id" type="text" placeholder="Shape ID" /></th>

                        <!-- segments in new_shape -->
                        <!-- <th v-for="segment in ns_segments"> -->
                        <th>
                            {{new_shape_sequence}}
                        </th>
                        <!-- end segments -->

                        <!-- new segment (a node and a link for direction)-->
                        <th v-show="!ns_segments.length">
                            <select @change="newShapeOnChange($event, 'node')">
                            <option value="noselect"> - </option>
                            <option v-for="node in new_shape_allowed_nodes" :value="node.getID">E{{node.getID}}</option>
                            </select>
                        </th>

                        <!-- allowed links -->
                        <th v-show="ns_allowed_links.length">
                            <select id="ns_shape_link_select" @change="newShapeOnChange($event, 'link')">
                               <option value="noselect"> - </option>
                               <option v-for="link in ns_allowed_links" :value="link.getID">L{{link.getID}}</option>
                            </select>
                        </th>

                        <!-- element to add new segments in shape? -->
                        <th><button @click="saveShapeStop()" v-show="ns_segments.length">abort</button></th>
                        <th><button @click="saveShape()">add</button></th>
                    </tr></table>
                    <br>
                    <table class="alt">
                        <thead>
                            <tr>
                                <th>{{ dict['shape_id'] ? dict['shape_id'] : 'shape_id' }}</th>
                                <th>{{ dict['shape_sequence'] ? dict['shape_sequence'] : 'shape_sequence' }}</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="shape in rev_shapes" :key="shape.getID()">
                                <td>{{shape.getID()}}</td>
                                <!-- <td>{{shape.getSequenceText()}}</td> // REMOVE method -->
                                <td>
                                    <a class="black_text" v-for="segment in shape.getSegments()" @click="goToNodeOnMap(segment[0])">
                                        <span class="orange_text">n{{segment[0]}}</span><span class="green_text">l{{segment[1]}}</span>,
                                    </a>
                                    <a class="orange_text" @click="goToNodeOnMap(shape.getSegments()[shape.getSegments().length -1][2])">
                                        n{{shape.getSegments()[shape.getSegments().length -1][2]}}
                                    </a>
                                </td>
                                <td><button class="button error" @click="removeShape(shape.getID())">remove</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- END SHAPES -->

                <!-- AGENCY -->
                <table v-show="isVisible('agency')" class="alt" style="table-layout: fixed; width: 100%; word-wrap: break-word;">
                    <thead>
                        <tr>
                            <th v-for="field in agencyFields">{{ dict[field] ? dict[field] : field }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" id="agency_id"       placeholder="ID" required></td> <!-- required TODO -->
                            <td><input type="text" id="agency_name"     placeholder="Name" required></td>
                            <td><input type="text" id="agency_url"      placeholder="URL" required></td>
                            <td><input type="text" id="agency_timezone" placeholder="Continent/Region" required></td>
                            <td><input type="text" id="agency_lang"     placeholder="Language"></td>
                            <td><input type="text" id="agency_phone"    placeholder="+0 8888 8888"></td>
                            <td><input type="text" id="agency_email"    placeholder="example@corp.com"></td>
                            <td><button @click="saveAgency">add</button></td>
                        </tr>
                        <tr v-for="agency in rev_agencies">
                            <td v-for="field in agencyFields" >{{agency.getInfo()[field.substring(7)]}}</td>
                            <td><button class="button error" @click="removeAgency(agency.getID())">remove</button></td>
                        </tr>

                    </tbody>
                </table>
                <!-- END AGENCY -->

                <!-- STOPS -->
                <table v-show="isVisible('stop')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in stopFields">{{ dict[field] ? dict[field] : field }}</th>

                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="stop in rev_stops">
                            <td><input type="text" :id="'stop_id_'+stop.getID"   :value="stop.getStopInfo().id" placeholder="Stop ID"></td>

                            <!-- Page 1 -->
                            <td><input type="text" :id="'stop_name_'+stop.getID" :value="stop.getStopInfo().name" placeholder="Name"></td>
                            <td><input type="text" :id="'stop_desc_'+stop.getID" :value="stop.getStopInfo().description" placeholder="Description"></td>

                            <!-- Page 2 -->
                            <td><input type="text" :id="'stop_url_'+stop.getID" placeholder="Info URL"></td>
                            <td><button @click="changeNodeInfoFromStopSection(stop.getID)">save</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END STOPS -->

                <!-- ROUTES -->
                <table v-show="isVisible('route')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in routeFields">{{ dict[field] ? dict[field] : field }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <!-- <th v-for="field in routeFields"><input type="text" :id="field"></th> -->
                            <td><input type="text" id="r_route_id" placeholder="Route ID"></td>
                            <td><select id="r_agency_id">
                                <option v-for="agency in rev_agencies" :value="agency.getID()">{{agency.getID()}}</option>
                            </select></td>
                            <td><input type="text" id="r_route_short_name" placeholder="Short name"></td>
                            <td><input type="text" id="r_route_long_name" placeholder="Long name"></td>
                            <td><select id="r_route_type">
                                <option v-for="routeType in r_routeType" :value="routeType.value">{{routeType.name}}</option>
                            </select></td>
                            <td><button @click="saveRoute">add</button></td>
                        </tr>
                        <tr v-for="route in rev_routes">
                            <td >{{route.getID()}}</td>
                            <td >{{route.getInfo().agency_id}}</td>
                            <td >{{route.getInfo().short_name}}</td>
                            <td >{{route.getInfo().long_name}}</td>
                            <td >{{route.typeToText()}}</td>
                            <td><button class="button error" @click="removeRoute(route.getID())">remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END ROUTES -->

                <!-- CALENDAR -->
                <table v-show="isVisible('calendar')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in calendarFields">{{ dict[field] ? dict[field] : field }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" id="c_service_id"></td>
                            <td v-for="field in calendarCheckboxFields">
                                <input type="checkbox" :id="field" checked="true">
                                <!-- <label for="view_nodes_cb">{{field}}</label><br> -->
                            </td>
                            <td><input type="date" id="c_start_day"></td>
                            <td><input type="date" id="c_end_day"></td>
                            <td><button @click="saveCalendar">add</button></td>
                        </tr>
                        <tr v-for="service in rev_services">
                            <td>{{ service.getID() }}</td>
                            <td v-for="status in service.getServiceDays()">
                                <div v-if="status" class="green_text">
                                    active
                                </div>
                                <div v-if="!status" class="red_text">
                                    inactive
                                </div>
                                <!-- status ? "active" : "inactive" -->
                            </td>
                            <td>
                                {{ service.getInfo().start_day }}
                            </td>
                            <td>
                                {{ service.getInfo().end_day }}
                            </td>
                            <td><button class="button error">remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END CALENDAR -->

                <!-- TRIPS -->
                <table v-show="isVisible('trip')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in tripFields">{{ dict[field] ? dict[field] : field }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <select id="t_route_id">
                                    <option v-for="route in rev_routes" :value="route.getID()">{{route.getID()}}</option>
                                </select>
                            </td>
                            <td><input type="text" id="t_trip_id"></td>
                            <td><select id="t_direction_id">
                                <option value="0">outbound travel</option>
                                <option value="1">inbound travel</option>
                            </select></td>
                            <td><select id="t_shape_id">
                                <option v-for="shape in rev_shapes" :value="shape.getID()">{{shape.getID()}}</option>
                            </select></td>
                            <td><button @click="saveTrip">add</button></td>
                        </tr>
                        <tr v-for="trip in rev_trips">

                            <td>{{trip.getInfo().route_id        }}</td>
                            <td>{{trip.getID()                   }}</td>
                            <td>{{trip.getInfo().direction_id    }}</td>
                            <td>{{trip.getInfo().shape_id        }}</td>

                            <td><button class="button error" @click="removeTrip(trip.getID())">remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END TRIPS -->

                <!-- STOPTIMES -->
                <table v-show="isVisible('stoptime')" class="alt">
                    <thead>
                        <tr>
                            <th v-for="field in stopTimeFields">{{ dict[field] ? dict[field] : field }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <select id="st_trip_id">
                                    <option v-for="trip in rev_trips" :value="trip.getID()">{{trip.getID()}}</option>
                                </select>
                            </td>

                            <td>
                                <input type="time" id="st_arrival_time" placeholder="HH:MM AM">
                            </td>
                            <td>
                                <input type="time" id="st_departure_time" placeholder="HH:MM PM">
                            </td>

                            <td>
                                <select @change="goToNodeOnMap(in_st_stop_id)" id="st_stop_id" v-model="in_st_stop_id">
                                    <option v-for="stop in stopsWhenTrip" :value="stop.getID">{{stop.getID}}: {{stop.getStopInfo().name ? stop.getStopInfo().name : "no name"}}</option>
                                </select>
                            </td>
                            <td><button @click="saveStopTime">add</button></td>
                        </tr>
                        <tr v-for="stoptime in rev_stoptimes">
                            <td>{{stoptime.getInfo().trip_id}}</td>
                            <td>{{stoptime.getInfo().arrival_time}}</td>
                            <td>{{stoptime.getInfo().departure_time}}</td>
                            <td>{{stoptime.getID()}}: {{nodes[stoptime.getID()].getStopInfo().name}}</td>
                            <td><button class="button error" @click="removeStopTime(stoptime.trip_id, stoptime.stop_id)">remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <!-- END STOPTIMES -->

                <!-- SCHEME -->
                <table v-show="isVisible('scheme')" class="alt">
                    <thead>
                        <tr>
                            <th>{{ dict.c_service_id }}</th>
                            <th>{{ dict.t_trip_id }}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <select>
                                    <option v-for="service in rev_services">{{ service.getID() }}</option>
                                </select>
                            </td>
                            <td>
                                <select>
                                    <option v-for="trip in rev_trips">{{ trip.getID() }}</option>
                                </select>
                            </td>
                            <td><button>add</button></td>
                        </tr>
                        <tr>

                        </tr>
                    </tbody>
                </table>
                <!-- END SCHEME -->

            </div>

            <!-- --------------  END key command board  --------------------- -->

            map: OpenStreetMap
        </div></div>

        <!-- <script src="https://unpkg.com/elm-pep"></script> -->
        <script src="https://unpkg.com/vue"></script>

        <!-- Vue 3 TODO -->
        <!-- <script src="https://unpkg.com/vue@3.0.0-beta.12/dist/vue.global.js"></script> -->

        <!-- OpenLayers library we use to show the map and draw on it -->
        <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>

        <!-- Axios to post data -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

        <!-- editor history / file loaded FIXME remove-->
        <script src="js/street_element_group_history.js"></script>

        <!-- Map GTFS elements -->
        <script src="js/streetElementNode.js"></script>        <!-- Node     class -->
        <script src="js/streetElementLink.js"></script>        <!-- Link     class -->
        <script src="js/streetElementAgency.js"></script>      <!-- Agency   class -->
        <script src="js/streetElementRoute.js"></script>       <!-- Route    class -->
        <script src="js/streetElementCalendar.js"></script>    <!-- Calendar class -->
        <script src="js/streetElementShape.js"></script>       <!-- Shape    class -->
        <script src="js/streetElementTrip.js"></script>        <!-- Trip     class -->
        <script src="js/streetElementStopTime.js"></script>    <!-- StopTime class -->
        <script src="js/streetElementGroup.js"></script>       <!-- Group    class -->

        <!-- variables and listeners -->
        <script src="js/map_main.js"></script>                 <!-- Map and JS -->
        <script src="js/app_main.js"></script>                 <!-- Vue app    -->
        <script src="js/overlay_toolbar.js"></script>          <!-- Toolbar    -->

    </body>
</html>
